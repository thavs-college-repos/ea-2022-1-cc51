---
title: "R Notebook"
output: html_notebook
---
```{r}
# Cargar las librerias relevantes
library(ggplot2)
library(dplyr)
library(scales)
```


# Carga de datos
Cargamos todos los datos en el data set `hotel_booking_missing.csv`. Usamos los parametros `header = TRUE` para indicar que nuestro dataset tiene una columna inicial con la descripttion de los datos y el parametro `stringAsFactors = False` para ... .

```{r}
hotel_bookings <- read.csv("hotel_bookings_miss.csv", header=TRUE, stringsAsFactors = TRUE)

names(hotel_bookings)[names(hotel_bookings) == 'Ã¯..hotel'] <- 'hotel'
```

# Inspeccionar Datos

## Visualizar

```{r}
head(hotel_bookings, 10)

tail(hotel_bookings, 10)
```

## Tipos de datos

```{r}
names(hotel_bookings)
str(hotel_bookings)
```
```{r}
summary(hotel_bookings)
```

## Modificar los tipos
Modificar el tipo de los datos a tipos de datos mas relevantes

```{r}
hb_data <- hotel_bookings
hb_data$is_canceled <- as.factor(hb_data$is_canceled)

hb_data$arrival_date_week_number <- as.factor(hb_data$arrival_date_week_number)
hb_data$arrival_date_year <- as.factor(hb_data$arrival_date_year)
hb_data$arrival_date_day_of_month  <- as.factor(hb_data$arrival_date_day_of_month)

hb_data$is_repeated_guest <- as.factor(hb_data$is_repeated_guest)

hb_data$reservation_status_date <- as.Date(hb_data$reservation_status_date, "%m/%d/%Y")

hb_data[sapply(hb_data, is.character)] <-
  lapply(hb_data[sapply(hb_data, is.character)], as.factor)
str(hb_data)
```


# PRE-PROCESAR DATOS
## Identificar datos faltantes
```{r}
columnns_NA_values <- function(x){
 count = 0

 for(i in 1:ncol(x)) {
   if (colSums(is.na(x[i]))){
      cat("NA values:",colSums(is.na(x[i])), "   \tColumn",colnames(x[i]),"\n")
      count = count + 1
   }
 }
 
 cat("Columns with NA values: ", count, "\n\n")
}

columnns_wempty_values <- function(x){
 count = 0

 for(i in 1:ncol(x)) {
   if (isTRUE(colSums(x[i]==""))){
      cat("NA values:",colSums(x[i]==""), "   \tColumn",colnames(x[i]),"\n")
      count = count + 1
   }
 }
 
 cat("Columns with empty values: ", count, "\n\n")
}

columnns_wnull_values <- function(x){
 count = 0

 for(i in 1:ncol(x)) {
   if (is.null(x[i])){
      cat("NA values:" ,colSums(is.null(x[i])), "   \tColumn",colnames(x[i]),"\n")
      count = count + 1
   }
 }
 
 cat("Columns with NULL values: ", count)
}


columnns_NA_values(hb_data)
columnns_wempty_values(hb_data)
columnns_wnull_values(hb_data)
```
Logramos identificar que existen 10 columnas con valores faltantes y ninguna de las columnas tiene valores vacios.

Las pregunstas que deseamos responder trabajan con las fechas de llegar

## Modicar datos faltantes
```{r}

```


```{r}
hb_lead_time <- hb_data[is.na(hb_data$lead_time),] # no clue
hb_lead_time


hb_empty_year <- hb_data[is.na(hb_data$arrival_date_year),]
#Change arrival date to last update year

hb_empty_month <- hb_data[is.na(hb_data$arrival_date_day_of_month),]
# We can calculate one . the other one not so much 


# 
hb_empty_adults <- hb_data[is.na(hb_data$adults ),]
hb_empty_children <- hb_data[is.na(hb_data$children ),]
hb_empty_babies <- hb_data[is.na(hb_data$babies ),]
n <- length(hb_data$children)
for (i in 1:n) {
  if (is.na(hb_data$children[i]))
    hb_data$children[i] <- hb_data$babies[i]
}
```



Cantidad de datos por tipos de hotel
```{r}
table(hb_data$hotel)

# Visualize the distribution
ggplot(data = hb_data, aes(x = hotel)) +
  geom_bar(stat = "count") +
  labs(title = "Booking Request by Hotel type",
       x = "Hotel type",
       y = "No. of bookings") +
  theme_classic() + scale_color_brewer(palette = "Set2")
```


```{r}
# Visualize the cancellation by hotel type
ggplot(data = hb_data,
       aes(
         x = hotel,
         y = prop.table(stat(count)),
         fill = factor(is_canceled),
         label = scales::percent(prop.table(stat(count)))
       )) +
  geom_bar(position = position_dodge()) +
  geom_text(
    stat = "count",
    position = position_dodge(.9),
    vjust = -0.5,
    size = 3
  ) +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Cancellation Status by Hotel Type",
       x = "Hotel Type",
       y = "Count") +
  theme_classic() +
  scale_fill_discrete(
    name = "Booking Status",
    breaks = c("0", "1"),
    labels = c("Cancelled", "Not Cancelled")
  )
```
```{r}
ggplot(data = hb_data, aes(
  x = hotel,
  y = lead_time,
  fill = factor(is_canceled)
)) +
  geom_boxplot(position = position_dodge()) +
  labs(
    title = "Cancellation By Hotel Type",
    subtitle = "Based on Lead Time",
    x = "Hotel Type",
    y = "Lead Time (Days)"
  ) +
  scale_fill_discrete(
    name = "Booking Status",
    breaks = c("0", "1"),
    labels = c("Cancelled", "Not Cancelled")
  ) + theme_light()
```
```{r}
# Reorganizar mes correctamente
hb_data$arrival_date_month <-
  factor(hb_data$arrival_date_month, levels = month.name)

# Visualize Hotel traffic on Monthly basis
ggplot(data = hb_data, aes(x = arrival_date_month)) +
  geom_bar(fill = "pink") +
  geom_text(stat = "count", aes(label = ..count..), hjust = 1) +
  coord_flip() + labs(title = "Reservas por mes",
                      x = "Mes",
                      y = "Reservas") +
  theme_classic()
```
Data es de pro
```{r}
ggplot(hb_data, aes(arrival_date_month, fill = hotel)) +
  geom_bar(position = position_dodge()) +
  labs(title = "Reservas por mes por hoteles",
       x = "Month",
       y = "Reservas") + theme_bw()
```
```{r}
# Average daily rate by Hotel Type
reserve_children <- hb_data$children[hb_data$children < 5]
reserve_children <- reserve_children[reserve_children != 0]

barplot(table(reserve_children), 
        main="Ninos/Babes en reservas",
        xlab= "Kids",
        col="#69b3a2",
        ylim=c(0,5000),
        ylab="Total de ninos en reservas",
        beside=TRUE
        ) + theme_bw()

#Outlier 10
```
```{r}
reserve_babies <- hb_data$children[hb_data$babies < 5]
reserve_babies <- reserve_children[hb_data$babies != 0]


barplot(table(reserve_babies), 
        main="Ninos/Babes en reservas",
        xlab= "Kids",
        col="#69b3a2",
        ylim=c(0,100),
        ylab="Total de ninos en reservas",
        beside=TRUE
        ) + theme_bw()
```

```{r}
#Espacios de estacionamiento por Hotel

parking_space_hotel1 <- hb_data%>% filter(hotel == 'Resort Hotel' & required_car_parking_spaces > 0 )%>% summarise("Parking Space - Resort Hotel")
parking_space_hotel2 <- hb_data%>% filter(hotel == 'City Hotel' & required_car_parking_spaces > 0 )%>% summarise("Parking Space - City Hotel")
parking <- tribble(
  ~Hotel_Type,     ~Parking_space,
  "Resort Hotel" , 	5490, 
  "City Hotel" , 1926
)

ggplot(data=parking) + geom_bar(mapping = aes(x = Hotel_Type, y =Parking_space), stat = "identity")

```


```{r}
cancelled <- subset(hb_data, reservation_status == "Canceled")
cmonths <- sort(substring(hb_data$arrival_date_month, first = 1 ))
barplot(sort(table(cmonths)), horiz=TRUE, main="Cancelations per month", 
        xlab="Bookings", ylab="Month")
```



